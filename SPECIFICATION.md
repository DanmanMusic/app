# Danmans Virtual Ticket App - Functional Specification

This document details the functional requirements, user roles, and workflows for the Danmans Music Store Virtual Ticket and Rewards application.

## 1. User Roles

The application supports four distinct user roles with specific permissions and interfaces:

- **Admin (Store Manager):** Has overarching control. Responsible for system setup, user management, managing core data (tasks library, rewards catalog, **instrument list**), and manual overrides/redemption processing. Access likely via secure login (e.g., username/password).
- **Teacher (Danmans Employee):** Manages their assigned students' tasks and progress. Assigns and verifies tasks to award tickets. Can view student progress, including their assigned instruments. Logs in via Admin-generated QR code.
- **Pupil (Music Student):** The primary recipient of tickets and rewards. Views assigned tasks, marks completion, tracks balance, and browses rewards. Can view their assigned instrument(s). Logs in via Admin-generated QR code (older students) or accessed via Parent login.
- **Parent (of Pupil):** Can link to one or more children's profiles, monitor their progress, mark tasks complete on their behalf, and view their child's ticket balance, history, and assigned instrument(s). Access via Admin-generated QR code ("Parent Link QR").

## 2. User Creation, Linking, and Authentication

- **Account Creation:** Exclusively performed by the **Admin** role via a secure Admin interface. Admin creates accounts for **Admin**, **Teacher**, and **Pupil** users.
- **User Linking:** Admin is responsible for establishing relationships via the Admin interface:
  - Linking **Pupil** accounts to **Teacher** accounts (initially assumed one primary teacher per student, but system _could_ support multiple).
  - Linking **Pupil** accounts to **Parent** access (mechanism detailed below). A single Parent device/session can be linked to multiple Pupils.
  - Assigning **Instrument(s)** to **Pupil** accounts (1-to-many relationship).
- **Authentication (Non-Admin Users - Teacher, Pupil, Parent):**
  - Initial login is facilitated by a unique QR code generated by the Admin for each user/link.
  - Admin interface has actions like "Generate Login QR for [Teacher]", "Generate Login QR for [Pupil]", and "Generate Parent Link QR for [Pupil]".
  - Teachers and Students install the app, select "Login", and scan their respective QR code from the Admin's device to log into their account.
  - Parents install the app, select "Login", and scan the "Parent Link QR" generated for their child. This logs them in and links their session to that Pupil. If they have multiple children, they scan a Parent Link QR for _each_ child they want to access on that device.
  - For a Parent acting _as_ a young student, they would scan the student's primary "Login QR" on their device. This logs the device in as that student.
- **Subsequent Logins & Recovery:** A mechanism is needed for users to log back in if they log out, uninstall, or get a new device. This likely involves Admins generating new QR codes or providing an alternative recovery method (TBD).
- **Parent Multi-Child Access:**
  - When a Parent logs in via a "Parent Link QR" and is linked to multiple Pupils, the initial screen is a Family Dashboard/selector showing linked children with key info (e.g., name, balance, **instrument(s)**).
  - Parent selects a child to enter their specific Pupil view.
  - Option to "Add Another Student" in the Parent view allows scanning additional Parent Link QRs to link more children to this Parent session/device.

_(**Undecided Element:** The exact backend structure for "Parent" access - is it a full Parent User account type managed by Admin, or just a managed 'link' generated per-student that provides parental permissions to a device? The current description leans towards Admin creating a Parent account, but the "Parent Link QR for Pupil" implies a per-student link. This needs final clarification.)_

## 3. Task Management

Defines the lifecycle of tasks assigned to students, leading to ticket awards.

- **Task Creation:**
  - **Admins** manage a central **Task Library** (Title, Description, Base Points Available) via the Admin interface.
  - **Teachers** can assign tasks from the Admin Task Library.
  - **Teachers** can create and assign custom tasks (Title, Description, Base Points Available) not in the library, specifically for their students.
- **Task Assignment:**
  - **Teachers** assign tasks to one or multiple students linked to them.
  - **Teachers** can potentially assign tasks to students not directly linked to them (e.g., by searching).
  - **Admins** can assign tasks (from library or custom) to individual students or groups. Admin can specifically filter student selection for **Challenge Tasks** by the **instrument(s)** the students play.
  - Tasks are visible to the assigned Pupil, their linked Parent(s), the assigning Teacher(s), and all Admins.
- **Task Completion (Pupil/Parent Action):**
  - Assigned tasks appear in the Pupil's view (and Parent's view when accessing the child).
  - Either the **Pupil** (if using their own login) or a linked **Parent** (acting on behalf of the Pupil) can mark an assigned task as "Complete".
- **Task Verification (Teacher/Admin Action):**
  - Any **Teacher** or **Admin** can view tasks marked as "Complete".
  - When verifying, the Teacher/Admin selects a status: **Verified**, **Partial Complete**, or **Incomplete**.
  - A secondary prompt appears with a slider/input defaulting to 100%, 50%, or 0% of the base Points Available based on the selected status. The Teacher/Admin can **adjust this final points value**.
  - Upon confirmation, the **adjusted points** are added to the student's ticket balance.
  - Immediately after, the Teacher/Admin is prompted with the option to "Re-assign" this same task to the student.
- **Task Editing/Deletion:** Assigned tasks can be edited or deleted by the original assigner or an Admin. _Clarification needed:_ Can tasks be edited/deleted after being marked complete/verified? (Likely not after verification, maybe archived).
- **Task History:** A history of assigned and verified tasks (including status, base points, and _actual points awarded_) is maintained and viewable by the assigned Pupil, their linked Parent(s), all Teachers (for any student), and all Admins.

## 4. Ticket Management

Defines how virtual tickets are tracked, awarded, and managed.

- **Earning Tickets:** Primarily earned through the **Teacher/Admin verification** of tasks with adjustable points.
- **Manual Adjustments:**
  - **Admins only** can manually add or subtract tickets from a student's balance via the Admin interface.
  - Manual adjustments (not tied to redemption) require a **mandatory note/reason**. This is used for onboarding existing physical tickets or correcting errors.
- **Redemption:**
  - **No in-app student/parent redemption process.** Physical redemption happens at the store.
  - The app facilitates recording "big ticket" redemptions: An **Admin** uses a specific action "Redeem [Reward Item] for [Student]" (likely from the Admin interface).
  - This Admin action automatically **subtracts the exact ticket cost** of the selected item from the student's balance.
  - This action creates a distinct "Redeemed" entry in the Ticket Transaction History.
  - This action also **triggers a public announcement** visible to all users (on the Announcements/Challenge Tasks screen) celebrating the student's achievement.
- **Ticket Balance Visibility:** The current virtual ticket balance for any student is visible to **all logged-in users** (the student themselves, their Parents, **all Teachers**, and all Admins).
- **Ticket Transaction History:** A detailed history of all ticket movements (task awards, manual adds, manual subtracts, redemptions) is maintained. Each entry includes Date/Timestamp, Amount (+/-), and Reason/Source. The full history is viewable by **all logged-in users** for the relevant student(s).

## 5. Rewards Catalog

Details the list of items students can redeem tickets for and its presentation.

- **Catalog Management:** Exclusively managed by **Admins** via the Admin interface.
- **Item Details:** Each item includes **Item Name**, **Ticket Cost**, **Image/Photo**, and optional **Description**.
- **Catalog Visibility:**
  - Visible to **all logged-in users**.
  - Visible to **non-logged-in users** as a public promotional feature for Danmans.
- **Presentation:**
  - Displayed in a sortable list/grid, defaulting to **cheapest to most expensive**.
  - **For logged-in users viewing a student's context:** Clearly indicates if the student has enough tickets or how many more are needed for each item. May visually separate affordable items.
  - **For non-logged-in users (Public View):** Shows items, costs, image, description, but no student-specific eligibility info.
- **Integration:** The catalog data is used by the Admin "Redeem for..." action to deduct the correct ticket cost and is key for the public announcement feature.

## 6. Parent View

Defines the interface and capabilities for users logged in as a Parent.

- **Core:** Provides access to the standard Pupil view experience but allows managing multiple linked children from one login.
- **Initial View:** If multiple children are linked, starts on a Family Dashboard/selector listing children with key info (name, balance, **instrument(s)**). If only one child, may go directly to that child's Pupil view.
- **Navigation:** Clear way to switch between linked children's Pupil views from the Family Dashboard/selector.
- **Capabilities (when viewing a specific child):** Same capabilities as a Pupil logged in as that child (View Balance, View Tasks, Mark Complete, View History, Browse Catalog with eligibility, View Announcements/Challenges, Set Wishlist item), plus viewing the child's assigned instrument(s).
- **Linking More Children:** Option to "Add Another Student" (e.g., on Family Dashboard) activates camera to scan a new "Parent Link QR" generated by Admin, linking another child to this Parent session/device.

## 7. Key Considerations and Potential Blind Spots

- **Backend:** A robust backend system is required to store all user data, task assignments, ticket balances, history, catalog information, **instrument list**, and announcement information persistently and securely. Needs to support role-based access control and the 1-to-many relationship between Pupils and Instruments. An Admin Web UI for management is highly recommended.
- **Real-time Updates:** Important for a good UX – task status, ticket balances, and announcements should update promptly across devices.
- **Push Notifications:** Essential for notifying users of key events (Task assigned, Task verified/tickets awarded, Reward redeemed, New Announcement/Challenge).
- **UI/UX:** Interfaces need to be intuitive and tailored for each role (especially the simple Pupil/Parent view vs. the more complex Teacher/Admin views). Gamification elements (progress bars, animations) are key for student engagement. Displaying instruments clearly in relevant views (Pupil, Parent, Teacher, Admin) is needed.
- **Security:** Protecting user data and preventing fraudulent ticket adjustments requires careful attention to authentication, authorization (permissions), and backend security. QR codes need a revocation/recovery mechanism.
- **Onboarding Existing Physical Tickets:** The Admin manual adjustment feature is explicitly needed for this initial data migration. Also need to ensure existing students are assigned instruments.
- **Gamification & Engagement:** Beyond mechanics, consider visual design and celebratory elements (e.g., when tickets are awarded or goals are reached). Instrument-specific challenges add a layer of engagement.
- **Offline Capability:** Determine if any features need to work offline (e.g., viewing current balance/tasks, viewing assigned instruments). Marking complete offline could sync later. Verification/Redemption/Management likely requires online access.

## 8. Undecided Elements

- **Parent Account Structure:** The exact backend model for Parents (dedicated user type vs. dynamic link per student per device) needs final decision. This impacts parent-specific features, multi-device sync for parents, and revocation complexity.
- **Teacher/Admin Task Visibility & Verification Scope:** Can _any_ Teacher/Admin verify _any_ student's completed task, or only tasks for students specifically linked to them? (Your feedback leaned towards "any", but this is a critical permission boundary).
- **Task Editing/Deletion Restrictions:** Precisely when and by whom tasks can be edited or deleted, especially after completion or verification.
- **Instrument Management Detail:** How complex does instrument management need to be? Just a name? Categories?

---
